(()=>{"use strict";function t(){const t=document.getElementById("fullscreen-loader");t&&t.classList.remove("active")}function e(){const t=document.getElementById("fullscreen-loader");t&&t.classList.add("active")}function i(t){const e=t.split(","),i=e[0].match(/:(.*?);/),s=i?i[1]:"application/octet-stream",n=atob(e[1]);let o=n.length;const a=new Uint8Array(o);for(;o--;)a[o]=n.charCodeAt(o);return new Blob([a],{type:s})}Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),Number.prototype.roundTo||(Number.prototype.roundTo=function(t){return parseFloat(parseFloat(String(this)).toFixed(t))}),Number.prototype.roundSig||(Number.prototype.roundSig=function(t){return parseFloat(parseFloat(String(this)).toPrecision(t))}),String.prototype.roundTo||(String.prototype.roundTo=function(t){return parseFloat(parseFloat(this).toFixed(t))}),Number.prototype.toDegrees||(Number.prototype.toDegrees=function(){return this*(180/Math.PI)}),Number.prototype.toRadians||(Number.prototype.toRadians=function(){return this*(Math.PI/180)}),Number.prototype.sigFigs||(Number.prototype.sigFigs=function(){const t=Math.log(10);let e=Math.abs(Number(String(this).replace(".","")));if(0===e)return 0;for(;0!==e&&e%10==0;)e/=10;return Math.floor(Math.log(e)/t)+1}),String.prototype.sigFigs||(String.prototype.sigFigs=function(){const t=Math.log(10);let e=Math.abs(Number(String(this).replace(".","")));if(0===e)return 0;for(;0!==e&&e%10==0;)e/=10;return Math.floor(Math.log(e)/t)+1}),Math.cot||(Math.cot=function(t){return 1/Math.tan(t)}),String.prototype.utf8Length||(String.prototype.utf8Length=function(){const t=encodeURIComponent(this).match(/%[89ABab]/g);return this.length+(t?t.length:0)});class s{constructor(t,e,i,s){this.track=t,this.frame=e,this.hidden=!1,this.x=i,this.y=s,this.pointSize=6,this.shape=new createjs.Shape,this.shape.cursor="pointer",this.shape.regX=this.pointSize/2,this.shape.regY=this.pointSize/2;const n=this.track.project.toUnscaled(i,s);this.shape.x=n.x,this.shape.y=n.y,this.shape.rotation=45,this.shape.hitArea=new createjs.Shape((new createjs.Graphics).beginFill("#000000").drawRect(-1,-1,12,12)),this.strokeWidth=this.shape.graphics.setStrokeStyle(2).command,this.strokeColor=this.shape.graphics.beginStroke(this.track.color).command,this.pointRect=this.shape.graphics.drawRect(0,0,this.pointSize,this.pointSize).command,this.circle=new createjs.Shape,this.circle.regX=(this.pointSize+6)/2,this.circle.regY=(this.pointSize+6)/2,this.circle.x=this.shape.x,this.circle.y=this.shape.y,this.circle.graphics.setStrokeStyle(2),this.circle.graphics.beginStroke(this.track.color),this.circle.graphics.drawEllipse(0,0,this.pointSize+6,this.pointSize+6),this.deleted=!1,"add"!==this.track.state.mode&&"hidden"!==this.track.state.mode&&this.track.stage.addChild(this.shape);const o=this;this.track.state.modeChange(function(t){"add"===t||"hidden"===t?(o.track.stage.removeChild(o.shape),o.track.stage.removeChild(o.circle)):o.deleted||o.hidden||o.track.stage.addChild(o.shape)});let a=!1;this.shape.on("pressmove",function(t){if("seek"!==o.track.project.state.mode){const e=o.track.project.toScaled(t.stageX,t.stageY);a=!0,o.move(e.x,e.y,!0),o.select()}}),this.shape.on("pressup",function(t){if("seek"!==o.track.project.state.mode&&a){a=!1;const e=o.track.project.toScaled(t.stageX,t.stageY),i={x:o.x,y:o.y};o.track.project.change({undo:function(){o.move(i.x,i.y)},redo:function(){o.move(e.x,e.y)}}),o.move(e.x,e.y),o.track.project.update()}}),this.shape.on("dblclick",function(){o.remove(),o.track.project.change({undo:function(){const t=o.track.deletedPoints[o.frame.number];t&&(t.deleted=!1,o.track.points[t.frame.number]=t,o.track.stage.addChild(t.shape),o.track.project.update())},redo:function(){o.remove()}})}),this.shape.on("click",function(){o.track.unselectAll(),o.select(),"seek"===o.track.project.state.mode&&(o.track.project.timeline.seek(o.frame.number),o.track.project.switchTrack(o.track.uid),o.track.project.changed())}),this.track.project.state.modeChange(function(t){o.shape.cursor="seek"===t?"crosshair":"pointer"})}hide(){return this.track.stage.removeChild(this.shape),this.track.stage.removeChild(this.circle),this.hidden=!0,this}show(){return this.deleted||(this.track.stage.addChild(this.shape),this.hidden=!1),this}color(t){this.strokeColor.style=t}export(t=this.track.project.axes,e=this.track.project.scale){const i=this;if(i.frame.number>=i.track.timeline.startFrame&&i.frame.number<=i.track.timeline.endFrame){if(!t)return;const s=t.convert(i.x,i.y),n={t:(i.track.project.videoSpeed*(i.frame.time-i.track.timeline.getFrameStart(i.track.timeline.startFrame))).roundSig(6),pixels:{x:0,y:0},scaled:{x:0,y:0}};return n.pixels.x=s.x.roundTo(5),n.pixels.y=s.y.roundTo(5),null==e?(n.scaled.x=s.x.roundTo(5),n.scaled.y=s.y.roundTo(5)):(n.scaled.x=e.convert(s.x).number.roundTo(5),n.scaled.y=e.convert(s.y).number.roundTo(5)),n}}emphasize(t=!1){return t||this.track.unemphasizeAll(),this.track.hidden||this.hidden||"add"===this.track.state.mode||this.track.stage.addChild(this.circle),this.circle.x=this.shape.x,this.circle.y=this.shape.y,this.track.emphasizedPoint=this,this}unemphasize(){this.track.stage.removeChild(this.circle),this.track.emphasizedPoint=null,this.track.stage.update()}select(t=!1){return t||this.track.unselectAll(),this.shape.rotation=0,this.strokeWidth.width=2,this.pointRect.w=this.pointSize+2,this.pointRect.h=this.pointSize+2,this.shape.regX=(this.pointSize+2)/2,this.shape.regY=(this.pointSize+2)/2,this.track.selectedPoint=this,this}unselect(){return this.shape.rotation=45,this.strokeWidth.width=2,this.pointRect.w=this.pointSize,this.pointRect.h=this.pointSize,this.shape.regX=this.pointSize/2,this.shape.regY=this.pointSize/2,this.track.selectedPoint=null,this}move(t,e,i=!1){const s=this.track.project.toUnscaled(t,e);return this.shape.x=s.x,this.shape.y=s.y,this.circle.x=s.x,this.circle.y=s.y,i||(this.x=t,this.y=e),this}remove(){this.track.stage.removeChild(this.shape),this.track.stage.removeChild(this.circle),this.unselect().unemphasize(),this.deleted=!0,this.track.deletedPoints[this.frame.number]=this,delete this.track.points[this.frame.number],this.track.project.update()}unRemove(){this.track.hidden||this.hidden||this.track.stage.addChild(this.shape),this.deleted=!1,this.track.points[this.frame.number]=this,delete this.track.deletedPoints[this.frame.number],this.track.project.update()}}class n{constructor(t,e){this.track=t,this.columns=e,this.data=[],this.tableData=[];const i=[];for(const t in e)i.push({title:t+"("+e[t]+")",type:"text"});this.settings={columns:i}}makeActive(){const t=this.settings,e=this.tableData;this.track.project.handsOnTable.updateSettings(t),e.length>0?this.track.project.handsOnTable.loadData(e):this.track.project.handsOnTable.loadData([null])}newCols(t){this.columns=t;const e=[];for(const i in t)e.push({title:i+"("+t[i]+")",type:"text"});this.settings.columns=e,this.track.project.handsOnTable.updateSettings(this.settings)}newData(t,e=!0,i=!0){i&&(this.tableData=[],this.data=[]);for(let e=0;e<t.length;e++){const i=[];for(const s in this.columns)void 0!==t[e][s]?i.push(t[e][s]):i.push(null);this.tableData.push(i),this.data.push(t[e])}this.sort(),i&&this.track.project.handsOnTable.updateSettings({data:[]}),e&&this.track.project.handsOnTable.loadData(this.tableData)}addColumn(t){for(const e in t)if(void 0===this.columns[e]){this.columns[e]=t[e];const i=[];for(let t=0;t<this.data.length;t++){const e=[];for(const i in this.columns)void 0!==this.data[t][i]?e.push(this.data[t][i]):e.push(null);i.push(e)}this.tableData=i,this.sort(),this.settings.columns.push({title:e+"("+t[e]+")",type:"text"}),this.makeActive()}}addRow(t,e=!1){const i=[];for(const e in this.columns)void 0!==t[e]?i.push(t[e]):i.push(null);this.data.push(t),this.tableData.push(i),this.sort(),e&&this.track.project.handsOnTable.loadData(this.tableData)}sort(t=0){"number"==typeof t?this.tableData.sort(function(e,i){const s=e[t],n=i[t];return null===s||null===n?0:s<n?-1:s>n?1:0}):this.data.sort(function(e,i){const s=e[t],n=i[t];return null===s||null===n||void 0===s||void 0===n?0:s<n?-1:s>n?1:0})}}class o{constructor(t,e,i,s,o,a=!1){var r;this.name=i,this.color=s,this.project=t,this.hidden=!1,this.selectedPoints={},null===this.project.scale||void 0===this.project.scale?this.unit="px":this.unit=this.project.scale.unit().toString(),this.timeline=e,this.stage=o,this.points={},this.deletedPoints={},this.selectedPoint=null,this.emphasizedPoint=null,this.table=new n(this,{t:"s",x:this.unit,y:this.unit}),this.uid=!1===a?(Math.round(1e8*Math.random())+1).toString():a.toString(),this.listElement={container:document.createElement("li"),swath:document.createElement("div"),name:document.createElement("div"),visibility:document.createElement("div"),delete:document.createElement("div")},this.listElement.container.setAttribute("data-uid",this.uid),this.listElement.container.title="Double Click to Edit",this.listElement.swath.classList.add("swath"),this.listElement.swath.style.background=this.color,this.listElement.name.classList.add("name"),this.listElement.name.innerText=this.name,this.listElement.visibility.classList.add("visibility"),this.listElement.visibility.title="Hide Track",this.listElement.delete.classList.add("delete"),this.listElement.delete.title="Delete Track";const l=null===(r=document.getElementById("track-list"))||void 0===r?void 0:r.querySelector("ul");l&&l.appendChild(this.listElement.container),this.listElement.container.appendChild(this.listElement.swath),this.listElement.container.appendChild(this.listElement.name),this.listElement.container.appendChild(this.listElement.delete),this.listElement.container.appendChild(this.listElement.visibility);const c=this;this.state={_mode:"default",_lastMode:"",_selected:!0,modeCallbacks:[],selectionCallbacks:[],set mode(t){this._mode!==t&&(this._lastMode=this._mode,this._mode=t),this.triggerChange()},get mode(){return this._mode},triggerChange(){for(let t=0;t<this.modeCallbacks.length;t++)this.modeCallbacks[t].call(c,this._mode,this._lastMode)},resetMode(){const t=this._lastMode;this._lastMode=this._mode,this._mode=t,this.triggerChange()},modeChange(t){this.modeCallbacks.push(t)},set selected(t){this._selected=t;for(let t=0;t<this.selectionCallbacks.length;t++)this.selectionCallbacks[t](this._selected)},get selected(){return this._selected},selectionChange(t){this.selectionCallbacks.push(t)}};const d=this;this.stage.addEventListener("click",function(t){const e=d.selectedPoint;if(null!=e){const i=e.shape.globalToLocal(t.stageX,t.stageY);(i.x<-1||i.x>12||i.y<-1||i.y>12)&&e.unselect()}}),this.listElement.container.addEventListener("click",function(){let t="";null!==d.project.track&&void 0!==d.project.track&&(t=d.project.track.uid),d.project.change({undo:function(){d.project.switchTrack(t)},redo:function(){d.project.switchTrack(d.uid)}}),d.project.switchTrack(d.uid)}),this.listElement.container.addEventListener("dblclick",function(){const t=window.editTrack;t&&t.push({name:d.name,color:d.color,uid:d.uid}).show()}),this.listElement.delete.addEventListener("click",function(t){t.stopPropagation(),d.project.change({undo:function(){d.project.undeleteTrack(d.uid)},redo:function(){d.project.deleteTrack(d.uid)}}),d.project.deleteTrack(d.uid)}),this.listElement.visibility.addEventListener("click",function(t){t.stopPropagation(),this.classList.contains("hidden")?(d.project.change({undo:function(){d.hide()},redo:function(){d.show()}}),d.show()):(d.project.change({undo:function(){d.show()},redo:function(){d.hide()}}),d.hide())},!1)}hide(){this.state.mode="hidden",this.hidden=!0,this.listElement.visibility.classList.add("hidden"),this.listElement.visibility.title="Make Visible"}show(){this.state.resetMode(),this.hidden=!1,this.listElement.visibility.classList.remove("hidden"),this.listElement.visibility.title="Hide Track"}update(t){for(const e in t)switch(e){case"name":this.name=t[e],this.listElement.name.innerText=this.name,this.project.changed();break;case"color":this.color=t[e],this.listElement.swath.style.background=this.color;for(const t in this.points)this.points[t].color(this.color);this.project.changed()}}export(t=this.project.axes,e=this.project.scale){const i=this,s={name:this.name,points:{scaled:[],pixels:[]},table:{scaled:[],pixels:[]}};s.table.scaled.push(["t (s)","x ("+i.unit+")","y ("+i.unit+")"]),s.table.pixels.push(["t (s)","x ("+i.unit+")","y ("+i.unit+")"]);for(const n in i.points)if(i.points.hasOwnProperty(n)){const o=i.points[n].export(t,e);if(void 0!==o){const t={pixels:{t:o.t,x:o.pixels.x,y:o.pixels.y},scaled:{t:o.t,x:o.scaled.x,y:o.scaled.y}};s.points.pixels.push(t.pixels),s.table.pixels.push([t.pixels.t,t.pixels.x,t.pixels.y]),s.points.scaled.push(t.scaled),s.table.scaled.push([t.scaled.t,t.scaled.x,t.scaled.y])}}return s}addPoint(t,e,i,n=!0){if(void 0!==this.points[t.number]){const s=this,n=this.points[t.number],o={x:n.x,y:n.y};return this.project.change({undo:function(){n.move(o.x,o.y),s.project.timeline.seek(t.number),s.project.update()},redo:function(){n.move(e,i),s.project.timeline.seek(t.number),s.project.update()}}),n.move(e,i).select(),this.project.trigger("newpoint"),this.project.update(),this.project.updateVisiblePoints(),this.points[t.number]}{const n=new s(this,t,e,i);this.points[t.number]=n,t.points.push(n),this.project.timeline.activeFrames.push(t);const o=this;this.project.change({undo:function(){n.remove(),o.project.timeline.seek(n.frame.number),o.project.update()},redo:function(){n.unRemove(),o.project.timeline.seek(n.frame.number),o.project.update()}});const a=n.export();return void 0!==a&&this.table.addRow({t:a.t,x:a.scaled.x,y:a.scaled.y},!0),this.project.trigger("newpoint"),this.project.updateVisiblePoints(),n}}unselectAll(){null!==this.selectedPoint&&void 0!==this.selectedPoint&&this.selectedPoint.unselect(),this.selectedPoint=null}unemphasizeAll(){null!==this.emphasizedPoint&&void 0!==this.emphasizedPoint&&this.emphasizedPoint.unemphasize(),this.emphasizedPoint=null}select(){var t;const e=null===(t=document.getElementById("track-list"))||void 0===t?void 0:t.querySelector("ul");e&&e.querySelectorAll("li").forEach(function(t){t.classList.remove("selected")}),this.listElement.container.classList.add("selected")}unselect(){this.listElement.container.classList.remove("selected")}}class a{constructor(t,e,i,s,n){this.stage=t,this.project=n,this.x=e,this.y=i,this.theta=0,this.color=s,this.styles={color:[]},this.size=4*Math.sqrt(Math.pow(window.innerWidth,2)+Math.pow(window.innerHeight,2)),this.shape=new createjs.Shape;const o=this.project.toUnscaled(this.x,this.y);this.shape.x=o.x,this.shape.y=o.y,this.shape.rotation=this.theta,this.shape.cursor="pointer",this.stage.addChild(this.shape),this.styles.color.push(this.shape.graphics.beginFill(this.color).command),this.shape.graphics.drawRect(19,-6,2,12),this.shape.graphics.drawRect(-this.size/2,-1,this.size,2),this.shape.graphics.drawRect(-1,-this.size/2,2,this.size),this.hitShape=new createjs.Shape,this.styles.color.push(this.hitShape.graphics.beginFill(this.color).command),this.hitShape.graphics.drawRect(-this.size/2,-3,this.size,6),this.hitShape.graphics.drawRect(-3,-this.size/2,6,this.size),this.shape.hitArea=this.hitShape;const a=this;let r=!1,l=!1;this.shape.addEventListener("mousedown",function(t){const e=t.target.stage.globalToLocal(t.stageX,t.stageY);r=!1,l=!1;const i=a.convert(a.project.toScaled(e));i.x<20&&i.x>-20&&i.y<20&&i.y>-20?(r=!0,a.shape.cursor="grabbing",a.stage.update(),a.stage._testMouseOver(!0)):i.x>20&&(l=!0,r=!1)}),this.shape.addEventListener("tick",function(e){const i=e.target.stage.globalToLocal(t.mouseX,t.mouseY),s=a.convert(a.project.toScaled(i.x,i.y));s.x<20&&s.x>-20&&s.y<20&&s.y>-20?r?a.shape.cursor="grabbing":(a.shape.cursor="grab",a.stage._testMouseOver(!0)):s.x>20?a.cursor():a.shape.cursor="default"}),this.shape.addEventListener("pressmove",function(t){const e=a.project.toScaled(t.stageX,t.stageY),i=a.project.toUnscaled(e);if(r)a.shape.cursor="grabbing",a.shape.x=i.x-1,a.shape.y=i.y-1;else if(l){let t=1,i=Math.PI;e.y>a.y&&e.x>a.x?(t=1,i=2*Math.PI):e.y>a.y&&e.x<a.x||e.y<a.y&&e.x<a.x?(t=1,i=Math.PI):e.y<a.y&&e.x>a.x&&(t=1,i=0);let s=t*(-t*Math.atan((a.y-e.y)/(a.x-e.x))+i);s===Math.PI&&e.x>a.x&&(s=0),a.cursor(s.toDegrees()),a.shape.rotation=-s.toDegrees()}}),this.shape.addEventListener("pressup",function(){if(r){const t={x:a.x,y:a.y},e=a.project.toUnscaled(t),i={x:a.shape.x,y:a.shape.y},s=a.project.toScaled(a.shape.x,a.shape.y);a.x=s.x,a.y=s.y,a.project.change({undo:function(){a.x=t.x,a.y=t.y,a.shape.x=e.x-1,a.shape.y=e.y-1,a.project.update()},redo:function(){a.x=s.x,a.y=s.y,a.shape.x=i.x-1,a.shape.y=i.y-1,a.project.update()}})}else if(l){const t=a.theta,e=a.theta=-a.shape.rotation.toRadians();a.project.change({undo:function(){a.theta=t,a.shape.rotation=-t.toDegrees(),a.project.update()},redo:function(){a.theta=e,a.shape.rotation=-e.toDegrees(),a.project.update()}})}a.project.update(),r=!1,l=!1})}hide(){this.stage.removeChild(this.shape)}show(){this.stage.addChild(this.shape)}rotate(t){this.theta=t,this.shape.rotation=-this.theta.toDegrees()}updateColor(t){this.color=t;for(let t=0;t<this.styles.color.length;t++)this.styles.color[t].style=this.color;this.project.changed()}cursor(t=this.theta.toDegrees()){t>=0&&t<=20||t>340&&t<=360?this.shape.cursor="ns-resize":t>20&&t<=60?this.shape.cursor="nw-resize":t>60&&t<=120?this.shape.cursor="ew-resize":t>120&&t<=160?this.shape.cursor="ne-resize":t>160&&t<=200?this.shape.cursor="ns-resize":t>200&&t<=250?this.shape.cursor="se-resize":t>250&&t<=290?this.shape.cursor="ew-resize":t>290&&t<=340&&(this.shape.cursor="ne-resize")}convert(t,e=null){if("object"==typeof t&&null===e&&(e=t.y,t=t.x),"number"!=typeof t||"number"!=typeof e)return{x:0,y:0};const i=t,s=-e,n=this.x,o=-this.y,a=Math.tan(this.theta),r=Math.cot(this.theta),l={x:0,y:0};l.x=(-o+s+a*n+r*i)/(r+a),l.y=a*l.x+(o-a*n);const c={x:0,y:0};c.x=(-s+o+a*i+r*n)/(r+a),c.y=-r*c.x+(o+r*n);let d=Math.sign(l.x-n);this.theta>.5*Math.PI&&this.theta<1.5*Math.PI&&(d*=-1);let h={x:d*Math.sqrt(Math.pow(l.y-o,2)+Math.pow(l.x-n,2)),y:Math.sign(c.y-o)*Math.sqrt(Math.pow(l.y-s,2)+Math.pow(l.x-i,2))};switch(this.theta){case 0:h={x:i-n,y:s-o};break;case.5*Math.PI:h={x:s-o,y:n-i};break;case Math.PI:h={x:n-i,y:o-s};break;case 1.5*Math.PI:h={x:o-s,y:i-n};break;case 2*Math.PI:h={x:i-n,y:s-o}}return h}}class r{constructor(t,e,i,s,n,o,a,r){if(this.stage=t,this.project=r,this.color=a,this.nodeSize=8,this.uid=(Math.round(1e8*Math.random())+1).toString(),this.positions=[{x:i,y:s},{x:n,y:o}],null==e)this.textValue=math.unit("1m").toString(),this.size=math.unit("1m");else{const t=this.processValue(e);!1!==t?(this.textValue=t.textValue,this.size=t.size):(this.textValue=math.unit("1m").toString(),this.size=math.unit("1m"))}this.hitArea=new createjs.Shape,this.hitArea.graphics.beginFill(this.color).drawRect(-1,-1,this.nodeSize+2,this.nodeSize+2),this.nodes=[new createjs.Shape,new createjs.Shape],this.nodes[0].hitArea=this.hitArea,this.nodes[1].hitArea=this.hitArea,this.nodes[0].regX=this.nodeSize/2,this.nodes[1].regX=this.nodeSize/2,this.nodes[0].regY=this.nodeSize/2,this.nodes[1].regY=this.nodeSize/2,this.styleCommands={colors:[]},this.styleCommands.colors[0]=this.nodes[0].graphics.beginStroke(this.color).command,this.styleCommands.colors[1]=this.nodes[1].graphics.beginStroke(this.color).command,this.nodes[0].graphics.drawEllipse(0,0,this.nodeSize,this.nodeSize),this.nodes[1].graphics.drawEllipse(0,0,this.nodeSize,this.nodeSize),this.nodes[0].cursor="pointer",this.nodes[1].cursor="pointer";const l=this.project.toUnscaled(i,s),c=this.project.toUnscaled(n,o);this.nodes[0].x=l.x,this.nodes[1].x=c.x,this.nodes[0].y=l.y,this.nodes[1].y=c.y,this.length=Math.sqrt(Math.pow(this.positions[0].y-this.positions[1].y,2)+Math.pow(this.positions[0].x-this.positions[1].x,2)),this.line=new createjs.Shape,this.line.graphics.setStrokeStyle("2"),this.styleCommands.colors.push(this.line.graphics.beginStroke(this.color).command),this.lineStart=this.line.graphics.moveTo(this.nodes[0].x,this.nodes[0].y).command,this.lineEnd=this.line.graphics.lineTo(this.nodes[1].x,this.nodes[1].y).command,this.line.graphics.endStroke(),this.textSizingElement=document.createElement("span"),this.textSizingElement.innerText=this.textValue,this.textSizingElement.classList.add("scale-text");const d=document.getElementById("main-container");d&&d.appendChild(this.textSizingElement),this.letterWidth=this.textSizingElement.getBoundingClientRect().width/this.textValue.length,this.textSizingElement.remove(),this.textElement=document.createElement("input"),d&&d.appendChild(this.textElement),this.textElement.classList.add("scale-text"),this.textElement.classList.add("not-editing"),this.textElement.type="text",this.textElement.readOnly=!0,this.textElement.style.border="2px "+this.color+" solid",this.textElement.style.color=this.color,this.textElement.style.width=this.letterWidth*this.textValue.length+"px",this.textElement.value=this.textValue,this.text=new createjs.DOMElement(this.textElement),this.textHitShape=new createjs.Shape,this.textHit=this.textHitShape.graphics.drawRect(this.text.x-this.text.regX,this.text.y-this.text.regY,this.text.offsetWidth,this.text.offsetHeight).command,this.stage.addChild(this.textHitShape),this.stage.addChild(this.text),this.stage.addChild(this.line),this.stage.addChild(this.nodes[0]),this.stage.addChild(this.nodes[1]),this.update(),this.stage.update(),this.project.update();const h=this;this.textElement.addEventListener("focus",function(){h.textElement.readOnly&&h.textElement.blur()}),["startEditing","dblclick"].forEach(function(t){h.textElement.addEventListener(t,function(){h.textElement.classList.add("editing"),h.textElement.classList.remove("not-editing"),h.textElement.readOnly=!1,h.textElement.value=math.format(h.size).toString(),h.update()})}),["change","keypress","keyup"].forEach(function(t){h.textElement.addEventListener(t,function(e){"keypress"!==t&&"keyup"!==t||"13"===e.key?(h.update(h.textElement.value),h.textElement.classList.remove("editing"),h.textElement.classList.add("not-editing"),h.textElement.blur(),h.textElement.readOnly=!0):h.update()})}),h.stage.addEventListener("click",function(t){h.textHitShape.globalToLocal(t.stageX,t.stageY).x>h.textElement.offsetWidth&&(h.update(h.textElement.value),h.textElement.classList.remove("editing"),h.textElement.classList.add("not-editing"),h.textElement.blur(),h.textElement.readOnly=!0)}),this.nodes[0].addEventListener("pressmove",function(t){const e=t.target.stage.globalToLocal(t.stageX,t.stageY);h.nodes[0].x=e.x,h.nodes[0].y=e.y;const i=h.project.toScaled(e);h.positions[0]=i,h.update(),h.stage.update()}),this.nodes[1].addEventListener("pressmove",function(t){const e=t.target.stage.globalToLocal(t.stageX,t.stageY);h.nodes[1].x=e.x,h.nodes[1].y=e.y;const i=h.project.toScaled(e);h.positions[1]=i,h.update(),h.stage.update()}),this.nodes[0].addEventListener("pressup",function(){h.project.update(),h.project.changed()}),this.nodes[1].addEventListener("pressup",function(){h.project.update(),h.project.changed()})}show(){const t=document.getElementById("main-container");t&&t.appendChild(this.textElement),this.stage.addChild(this.textHitShape),this.stage.addChild(this.text),this.stage.addChild(this.line),this.stage.addChild(this.nodes[0]),this.stage.addChild(this.nodes[1]),this.update()}hide(){this.stage.removeChild(this.textHitShape),this.stage.removeChild(this.text),this.stage.removeChild(this.line),this.stage.removeChild(this.nodes[0]),this.stage.removeChild(this.nodes[1]);const t=document.getElementById("main-container");t&&t.removeChild(this.textElement)}updateInfo(t){for(const e in t)if("color"===e){this.color=t[e],this.textElement.style.color=this.color,this.textElement.style.border="2px "+this.color+" solid";for(let t=0;t<this.styleCommands.colors.length;t++)this.styleCommands.colors[t].style=this.color;this.project.changed()}}unit(){return this.size.units[0].unit.name}processValue(t){const e={};if(!(t.length>0))return!1;try{if(t.split(">").length>1){const i=t.split(">");math.unit(i[0].trim()),e.size=math.unit(i[0].trim()).to(i[i.length-1].trim()),e.textValue=math.format(e.size,{notation:"auto",precision:6}).toString()}else e.size=math.unit(t),e.textValue=math.format(math.unit(t),{notation:"auto",precision:6}).toString()}catch(t){return!1}return e}update(t=this.textValue){const e=this;if(t!==e.textValue){let i=this.processValue(t);if(i||(i=this.processValue(t.trim()+" m")),!1!==i)if(null!==i.size.value){const t={size:e.size,textValue:e.textValue};e.size=i.size,e.textValue=i.textValue;const s={size:e.size,textValue:e.textValue};t.size.toString()!==s.size.toString()&&e.project.change({undo:function(){e.update(t.size.toString())},redo:function(){e.update(s.size.toString())}}),e.project.update(),e.textElement.value=e.textValue}else e.textElement.value=e.textValue;else e.textElement.value=e.textValue}e.lineStart.x=e.nodes[1].x,e.lineStart.y=e.nodes[1].y,e.lineEnd.x=e.nodes[0].x,e.lineEnd.y=e.nodes[0].y,e.length=Math.sqrt(Math.pow(e.positions[0].y-e.positions[1].y,2)+Math.pow(e.positions[0].x-e.positions[1].x,2)),e.textElement.style.width=e.letterWidth*e.textElement.value.length+"px",e.nodes[0].x<e.nodes[1].x&&e.nodes[0].y<e.nodes[1].y||e.nodes[1].x<e.nodes[0].x&&e.nodes[1].y<e.nodes[0].y?(e.text.regX=0,e.text.regY=e.textElement.offsetHeight,e.text.x=e.nodes[1].x+(e.nodes[0].x-e.nodes[1].x)/2,e.text.y=e.nodes[1].y+(e.nodes[0].y-e.nodes[1].y)/2):(e.text.regX=e.textElement.offsetWidth,e.text.regY=e.textElement.offsetHeight,e.text.x=e.nodes[1].x+(e.nodes[0].x-e.nodes[1].x)/2,e.text.y=e.nodes[1].y+(e.nodes[0].y-e.nodes[1].y)/2),Math.abs((e.nodes[1].y-e.nodes[0].y)/(e.nodes[1].x-e.nodes[0].x))<.4&&(e.text.regX=.5*e.textElement.offsetWidth,e.text.regY=e.textElement.offsetHeight,e.text.x=e.nodes[1].x+(e.nodes[0].x-e.nodes[1].x)/2,e.text.y=e.nodes[1].y+(e.nodes[0].y-e.nodes[1].y)/2),e.textHit.x=e.text.x-e.text.regX,e.textHit.y=e.text.y-e.text.regY,e.textHit.w=e.textElement.offsetWidth,e.textHit.h=e.textElement.offsetHeight,e.stage.update()}convert(t,e=math.unit(this.unit())){return{number:math.unit(math.multiply(t,math.divide(this.size,this.length))).to(e.toString()).toNumber(e.toString())}}}class l{constructor(t,e,i){this.time=e,this.number=i,this.timeline=t,this.uid=(Math.round(1e5*Math.random())+1).toString(),this.points=[]}}class c{constructor(t,e=!0){this.name=t.name,this.id=t.id,this.fields=t.fields,this.buttons=t.buttons,this.text=t.text,this.callbacks={},this.created=!1,this.defaultColors=["#FFFF00","#FFFF33","#F2EA02","#E6FB04","#FF0000","#FD1C03","#FF3300","#FF6600","#00FF00","#00FF33","#00FF66","#33FF00","#00FFFF","#099FFF","#0062FF","#0033FF","#FF00FF","#FF00CC","#FF0099","#CC00FF","#9D00FF","#CC00FF","#6E0DD0","#9900FF"],e&&this.create()}on(t,e){const i=t.split(",");for(let t=0;t<i.length;t++){const s=i[t].trim();void 0===this.callbacks[s]&&(this.callbacks[s]=[]),this.callbacks[s].push(e),"create"===s&&this.created&&e.call(this,this.export())}return this}show(){const t=document.getElementById("modal-container"),e=document.getElementById(this.id);return t&&t.classList.add("active"),e&&e.classList.add("active"),this}hide(){if([...document.querySelectorAll(".modal.active")].length<=1){const t=document.getElementById("modal-container");t&&t.classList.remove("active")}const t=document.getElementById(this.id);return t&&t.classList.remove("active"),this}create(t=!1){const e=document.createElement("div");e.classList.add("modal-title"),e.innerText=this.name,this.element=document.createElement("div"),this.element.classList.add("modal"),this.element.id=this.id,this.element.appendChild(e);for(const t in this.fields){const e=document.createElement("div");e.classList.add("form-item"),e.setAttribute("data-key",t);const i=this.id+"_input-"+t,s=document.createElement("input");if("color"===this.fields[t].type?(s.type="text",s.classList.add("colorpicker"),this.fields[t].picker=new CP(s),this.fields[t].picker.on("change",function(t){this.target.value="#"+t,this.target.style.background="#"+t})):s.type=this.fields[t].type,s.name=i,s.id=i,s.setAttribute("data-key",t),this.fields[t].id=i,this.fields[t].element=e,void 0!==this.fields[t].defaultValue&&void 0===this.fields[t].initVal&&(this.fields[t].initVal=this.fields[t].defaultValue),void 0===this.fields[t].initVal&&("color"===this.fields[t].type?this.fields[t].initVal=this.defaultColors[Math.floor(Math.random()*this.defaultColors.length)]:this.fields[t].initVal=""),s.value=String(this.fields[t].initVal),"color"===this.fields[t].type&&(s.style.background=String(this.fields[t].initVal),this.fields[t].picker.set(String(this.fields[t].initVal))),"hidden"!==this.fields[t].type){const s=document.createElement("label");s.innerText=(this.fields[t].label||t)+":",s.htmlFor=i,e.appendChild(s)}e.appendChild(s),this.element.appendChild(e)}if(void 0!==this.text){this.textContainer=document.createElement("div");for(let t=0;t<this.text.length;t++){const e=document.createElement("p");e.innerHTML=this.text[t],this.textContainer.appendChild(e)}this.element.appendChild(this.textContainer)}const i=document.createElement("div");i.classList.add("form-buttons");for(const t in this.buttons){const e=document.createElement("button");e.type="button",e.id=this.id+"_button-"+t,void 0!==this.buttons[t].image?(e.title=this.buttons[t].label,e.style.backgroundImage="url('"+this.buttons[t].image+"')"):e.innerText=this.buttons[t].label;const s=this,n=t;e.addEventListener("click",function(){s.trigger(n)}),i.appendChild(e)}this.element.appendChild(i);const s=document.getElementById("modal-container");return s&&s.appendChild(this.element),this.created=!0,this.trigger("create"),t&&this.show(),this}trigger(t){if(void 0!==this.callbacks[t])for(let e=0;e<this.callbacks[t].length;e++)this.callbacks[t][e].call(this,this.export())}export(){const t={};for(const e in this.fields){const i=this.fields[e].id;if(!i)return!1;const s=document.getElementById(i);if(!(s&&s.value.length>0))return!1;t[e]=s.value}return t}clear(){for(const t in this.fields){void 0===this.fields[t].initVal&&(this.fields[t].initVal="");const e=this.fields[t].id;if(e){const i=document.getElementById(e);i&&(i.value=String(this.fields[t].initVal))}}return this}push(t){for(const e in t)if(void 0!==this.fields[e]){const i=this.fields[e].id;if(i){const s=document.getElementById(i);s&&(s.value=t[e],"color"===this.fields[e].type&&(this.fields[e].picker.set(t[e]),s.style.background=t[e]))}}return this}}const d=["xlsx","xlsm","xlsb","xls","ods","fods","csv","txt","sylk","html","dif","dbf","rtf","prn","eth"],h="jstrack",u=document.getElementById("sidebar"),m=document.getElementById("video-container"),p=document.getElementById("main"),g=new createjs.Stage("main"),f=new createjs.Bitmap(document.getElementById("video")),y=new createjs.Bitmap(document.getElementById("video-clone"));g.addChild(y),g.addChild(f);const b=document.getElementById("table"),v=new class{constructor(t,e,i,s,n){this.name=t,this.created=!1,this.uid=1e14*Math.random(),this.timeline=e,this.stage=s,this.videoName="",this.addBackground=new createjs.Shape;const o=new createjs.Shape;o.graphics.beginFill("#000000"),o.graphics.drawRect(-1e4,-1e4,3e4,3e4),this.addBackground.hitArea=o,this.background=n,this.backgroundScale=0,this.saved=!0,this.backedUp=!0,this.backUpDate=null,this.videoFile=null,this.track=null,this.scale=null,this.axes=null,this.trackList={},this.deletedTracks={},this.axesList=[],this.callbacks={},this.undoManager=new UndoManager,this.saveIndex=this.backUpIndex=this.undoManager.getIndex(),this.viewPoints={forward:0,backward:7},this.videoSpeed=1,this.handsOnTable=i,this.handsOnTable.updateSettings({readOnly:!0,autoColumnSize:!0,manualColumnResize:!0,manualColumnMove:!0,tableClassName:"data-table-master",rowHeaders:!1,colHeaders:!0,startRows:3,fixedColsLeft:1,preventOverflow:"horizontal",type:"numeric",stretchH:"last"});const a=this;this.positioning={_zoom:1,_x:0,_y:0,stuck:!0,autoZoom:!0,_callbacks:{},get zoom(){return this._zoom},set zoom(t){const e=this._zoom;this._zoom=t.roundTo(5),this.autoZoom=!1;const i=this._zoom-e;a.background.scale=a.backgroundScale*this._zoom,a.background.w=a.background.scale*a.timeline.video.videoWidth,a.background.h=a.background.scale*a.timeline.video.videoHeight,a.updateScale(),e>this._zoom?this.trigger("zoomout",{delta:i}):this.trigger("zoomin",{delta:i}),this.trigger("zoom",{delta:i})},get x(){return this._x},set x(t){this._x=t.roundTo(5),a.background.x=this._x,a.updateScale(),this.trigger("translation")},get y(){return this._y},set y(t){this._y=t.roundTo(5),a.background.y=this._y,a.updateScale(),this.trigger("translation")},trigger(t,e={}){if(e.event=t,void 0!==this._callbacks[t]){const i=this._callbacks[t];for(let t=0;t<i.length;t++)i[t].call(a,e)}},on(t,e){const i=t.split(",");for(let t=0;t<i.length;t++){const s=i[t].trim();void 0===this._callbacks[s]&&(this._callbacks[s]=[]),this._callbacks[s].push(e)}return this}},this.state={_mode:"default",_lastMode:"",modeCallbacks:[],selectionCallbacks:[],set mode(t){this._mode!==t&&(this._lastMode=this._mode,this._mode=t),this.triggerChange()},get mode(){return this._mode},triggerChange(){for(let t=0;t<this.modeCallbacks.length;t++)this.modeCallbacks[t].call(a,this._mode,this._lastMode)},reset(){const t=this._lastMode;this._lastMode=this._mode,this._mode=t,this.triggerChange()},modeChange(t){this.modeCallbacks.push(t)},default(){this._mode="default",this.triggerChange()}},this.state.modeChange(function(t){switch("add"===t?(null!==this.axes&&void 0!==this.axes&&this.axes.hide(),null!==this.scale&&void 0!==this.scale&&this.scale.hide()):(null!==this.axes&&void 0!==this.axes&&this.axes.show(),null!==this.scale&&void 0!==this.scale&&this.scale.show()),t){case"seek":this.stage.removeChild(this.addBackground),this.stage.cursor="crosshair";break;case"add":case"newScale":switch(this.stage.addChild(this.addBackground),platform.name){case"Firefox":this.stage.cursor="url('icons/add_point.png') 16 16, copy";break;case"Chrome":this.stage.cursor="url('icons/add_point.png') 8 8, copy";break;default:this.stage.cursor="copy"}break;case"positioning":this.stage.addChild(this.addBackground),this.stage.cursor="move";break;default:this.stage.removeChild(this.addBackground),this.stage.cursor="default",this.updateVisiblePoints()}this.stage._testMouseOver(!0)}),this.timeline.project=this}toUnscaled(t,e=null){let i,s;"object"==typeof t?(i=t.x,s=null!==e?e:t.y):(i=t,s=null!==e?e:0);const n=this.timeline.video.videoWidth*(this.backgroundScale*this.positioning.zoom),o=this.timeline.video.videoHeight*(this.backgroundScale*this.positioning.zoom),a=this.timeline.video.videoWidth,r=this.timeline.video.videoHeight;return{x:i/a*n+this.positioning.x,y:s/r*o+this.positioning.y}}toScaled(t,e=null){let i,s;"object"==typeof t?(i=t.x,s=null!==e?e:t.y):(i=t,s=null!==e?e:0);const n=this.timeline.video.videoWidth*(this.backgroundScale*this.positioning.zoom),o=this.timeline.video.videoHeight*(this.backgroundScale*this.positioning.zoom),a=this.timeline.video.videoWidth,r=this.timeline.video.videoHeight;return{x:(i-this.positioning.x)/n*a,y:(s-this.positioning.y)/o*r}}updateScale(){if(void 0!==this.axes&&null!==this.axes){const t=this.toUnscaled(this.axes.x,this.axes.y);this.axes.shape.x=t.x,this.axes.shape.y=t.y}for(let t=0;t<this.timeline.frames.length;t++){const e=this.timeline.frames[t];for(let t=0;t<e.points.length;t++){const i=e.points[t],s=this.toUnscaled(i.x,i.y);i.shape.x=i.circle.x=s.x,i.shape.y=i.circle.y=s.y}}if(void 0!==this.scale&&null!==this.scale){const t=[this.toUnscaled(this.scale.positions[0]),this.toUnscaled(this.scale.positions[1])];this.scale.nodes[0].x=t[0].x,this.scale.nodes[0].y=t[0].y,this.scale.nodes[1].x=t[1].x,this.scale.nodes[1].y=t[1].y,this.scale.update()}}undo(){this.undoManager.undo(),this.saveIndex!==this.undoManager.getIndex()&&(this.saved=!1,this.trigger("change")),this.backUpIndex!==this.undoManager.getIndex()&&(this.backedUp=!1,this.trigger("change")),this.trigger("undo")}redo(){this.undoManager.redo(),this.saveIndex!==this.undoManager.getIndex()&&(this.saved=!1,this.trigger("change")),this.backUpIndex!==this.undoManager.getIndex()&&(this.backedUp=!1,this.trigger("change")),this.trigger("redo")}backup(){this.backedUp=!0,this.backUpDate=new Date,this.backUpIndex=this.undoManager.getIndex()}on(t,e){const i=t.split(",");for(let t=0;t<i.length;t++){const s=i[t].trim();void 0===this.callbacks[s]&&(this.callbacks[s]=[]),this.callbacks[s].push(e)}return this}trigger(t,e=[]){const i=t.split(",");for(let t=0;t<i.length;t++){const s=i[t].trim();if(void 0!==this.callbacks[s])for(let t=0;t<this.callbacks[s].length;t++)this.callbacks[s][t].call(this,e)}return this}changed(){return this.saved=!1,this.backedUp=!1,this.trigger("change"),this}change(t){return this.saved=!1,this.backedUp=!1,this.undoManager.add({undo:t.undo,redo:t.redo}),this.trigger("change"),this}updateVisiblePoints(){if("add"!==this.state.mode){for(let t=0;t<this.timeline.activeFrames.length;t++){const e=this.timeline.activeFrames[t];if(e.number<this.timeline.currentFrame-this.viewPoints.backward*this.timeline.frameSkip||e.number>this.timeline.currentFrame+this.viewPoints.forward*this.timeline.frameSkip||e.number<this.timeline.startFrame||e.number>this.timeline.endFrame)for(let t=0;t<e.points.length;t++)e.points[t].hidden||e.points[t].hide();else for(let t=0;t<e.points.length;t++)e.points[t].hidden&&e.points[t].show()}void 0!==this.track&&null!==this.track&&null!==this.track.emphasizedPoint&&void 0!==this.track.emphasizedPoint&&this.track.emphasizedPoint.emphasize()}return this}destroy(){for(const t in this.trackList)this.trackList[t].listElement.container.remove();return null!==this.scale&&void 0!==this.scale&&this.scale.textElement.remove(),this.handsOnTable.destroy(),this}save(){const t={date:(new Date).toString(),createdWith:"Created with JSTrack by Luca Demian",appVersion:.1,fileVersion:.3},e={name:this.name,duration:this.timeline.duration,video:this.timeline.video,fps:this.timeline.fps,currentFrame:this.timeline.currentFrame,uid:this.uid,startFrame:this.timeline.startFrame,endFrame:this.timeline.endFrame,videoName:this.videoName,videoSpeed:this.videoSpeed};null!==this.scale&&void 0!==this.scale&&(e.scale={size:this.scale.size.toString(),color:this.scale.color,nodes:[{x:this.scale.positions[0].x,y:this.scale.positions[0].y},{x:this.scale.positions[1].x,y:this.scale.positions[1].y}]}),null!==this.axes&&void 0!==this.axes&&(e.axes={position:{x:this.axes.x,y:this.axes.y,rotation:this.axes.theta},color:this.axes.color}),null!==this.track&&void 0!==this.track&&(e.activeTrack=this.track.uid),e.tracks={};for(const t in this.trackList){const i=this.trackList[t],s={name:i.name,color:i.color,points:{},hidden:i.hidden};for(const t in i.points)s.points[t]={x:i.points[t].x,y:i.points[t].y};e.tracks[t]=s}return{meta:t,project:e}}load(t){let e=0;const i=t.meta;let s;if(void 0!==i?(e=i.fileVersion,s=e>0&&t.project||t):s=t,void 0!==s.fps)this.timeline.updateTiming(this.timeline.video.duration,s.fps),1===this.timeline.frames.length&&this.timeline.createFrames(),this._load(s,e);else{const t=this;this.timeline.detectFrameRate(function(i){t.timeline.updateTiming(t.timeline.video.duration,i),1===t.timeline.frames.length&&t.timeline.createFrames(),t._load(s,e)})}return this}_load(t,e){for(const i in t){const s=t[i];switch(i){case"name":this.name=s;break;case"uid":this.uid=s;break;case"videoName":this.videoName=s;break;case"videoSpeed":this.videoSpeed=s;break;case"currentFrame":this.timeline.seek(s);break;case"startFrame":this.timeline.startFrame=s;break;case"endFrame":this.timeline.endFrame=s;break;case"scale":{const t=s;this.newScale(t.size,t.nodes[0].x,t.nodes[0].y,t.nodes[1].x,t.nodes[1].y,t.color,!0);break}case"axes":{const t=s,i=this.newAxes(t.position.x,t.position.y,t.color,!0);e>0&&i.rotate(t.position.rotation);break}case"tracks":{const t=s;for(const i in t){const s=t[i],n=this.newTrack(s.name,s.color,!1,i);for(const t in s.points){const e=this.timeline.frames[Number(t)];void 0!==e&&n.addPoint(e,s.points[t].x,s.points[t].y)}n.unselectAll(),e>.2&&s.hidden&&n.hide()}break}}void 0!==t.activeTrack&&null!==t.activeTrack&&this.switchTrack(t.activeTrack)}this.updateVisiblePoints(),this.created=!0,this.trigger("created"),this.undoManager.clear()}deleteTrack(t){if(void 0!==this.trackList[t]){const e=this.trackList[t];this.deletedTracks[t]=e;for(const t in e.points){const i=e.points[t];i.unemphasize(),i.unselect(),e.stage.removeChild(i.shape);for(let t=0;t<i.frame.points.length;t++)i.frame.points[t]===i&&(i.frame.points.splice(t,1),t--)}this.track===e&&(this.track=null),e.listElement.container.remove(),delete this.trackList[t],this.trigger("deleteTrack",[e])}}undeleteTrack(t){var e;if(void 0!==this.deletedTracks[t]){const i=this.deletedTracks[t];this.trackList[t]=i;const s=null===(e=document.getElementById("track-list"))||void 0===e?void 0:e.querySelector("ul");s&&s.appendChild(i.listElement.container);for(const t in i.points){const e=i.points[t];e.unemphasize(),e.unselect(),e.show(),e.frame.points.push(e)}this.updateVisiblePoints(),this.switchTrack(t),delete this.deletedTracks[t],this.trigger("undeleteTrack",[i])}}newTrack(t,e,i=!0,s=!1){const n=this,a=new o(this,this.timeline,t,e,this.stage,s);return this.change({undo:function(){n.deleteTrack(a.uid)},redo:function(){n.undeleteTrack(a.uid)}}),this.trackList[a.uid]=a,i&&(this.track=a,this.track.select()),a.table.makeActive(),this.trigger("newTrack",[a]),a}newAxes(t,e,i,s=!0){const n=new a(this.stage,t,e,i,this);return this.axesList.push(n),s&&(this.axes=n),n}newScale(t,e,i,s,n,o="#39ff14",a=!0){const l=this,c=new r(this.stage,t,e,i,s,n,o,this);return this.change({undo:function(){l.deleteScale(c.uid)},redo:function(){l.newScale(t,e,i,s,n,o,a)}}),a&&(this.scale=c),this.trigger("newScale",[c]),c}deleteScale(t){this.scale&&this.scale.uid===t&&(this.scale.hide(),this.scale=null)}switchTrack(t){if(void 0!==this.trackList[t]){null!==this.track&&void 0!==this.track&&(this.track.unselectAll(),this.track.unemphasizeAll()),this.track=this.trackList[t],this.track.select(),this.track.table.makeActive();let e=this.track.export().points.scaled;0===e.length&&(e=[{"":""}]),this.track.table.newData(e,!0,!0),void 0!==this.track.points[this.timeline.currentFrame]&&this.track.points[this.timeline.currentFrame].emphasize()}return this}update(){for(const t in this.trackList){const e=this.trackList[t];null===this.scale||void 0===this.scale?e.unit="px":(e.scale=this.scale,e.unit!==this.scale.unit().toString()&&(e.unit=this.scale.unit().toString(),e.table.newCols({t:"s",x:e.unit,y:e.unit})))}if(null!==this.track&&void 0!==this.track){let t=this.track.export().points.scaled;0===t.length&&(t=[{"":""}]),this.track.table.newData(t,!0,!0)}return this}}("My Project",new class{constructor(t,e,i,s){this.duration=i.duration.roundTo(3),this.video=i,this.width=t,this.height=e,this.fps=s,this.frameSkip=1,this.frameTime=(1/this.fps).roundTo(3),this.frameCount=Math.floor(this.duration/this.frameTime),this.currentTime=0,this.currentFrame=0,this.lastFrame=-1,this.direction="forward",this.savedTime=0,this.seekSaved=!1,this.startFrame=0,this.endFrame=1,this.callbacks={},this.frames=[new l(this,0,0)],this.activeFrames=[]}createFrames(){let t=1;for(let e=this.frameTime;e<=this.video.duration;e=(e+this.frameTime).roundTo(3))this.frames[t]=new l(this,e,t),t++}trigger(t,e=[]){const i=t.split(",");for(let t=0;t<i.length;t++){const s=i[t].trim();if(void 0!==this.callbacks[s])for(let t=0;t<this.callbacks[s].length;t++)this.callbacks[s][t].call(this,e)}}on(t,e){const i=t.split(",");for(let t=0;t<i.length;t++){const s=i[t].trim();void 0===this.callbacks[s]&&(this.callbacks[s]=[]),this.callbacks[s].push(e)}}detectFrameRate(t=null){const e=1/240;let i=null;const s=document.createElement("video");let n=!0;s.onloadeddata=function(){if(n){n=!1,s.currentTime=s.duration;const o=document.createElement("canvas");o.height=s.videoHeight,o.width=s.videoWidth;const a=o.getContext("2d");if(!a)return;a.drawImage(s,0,0,o.width,o.height);let r=0;s.currentTime=r;let l=o.toDataURL();console.log("Detecting Framerate...");let c=0,d=0;s.addEventListener("timeupdate",function(){if(a.drawImage(s,0,0,o.width,o.height),0===r&&(l=o.toDataURL()),i=o.toDataURL(),i!==l&&0===c)d=r,l=i,r+=e,c++,s.currentTime=r;else if(i!==l&&1===c){c++;let e=(s.duration/(r-d)/s.duration).roundTo(2);"Firefox"===platform.name&&34.29===e&&(e=30),console.log(e+" FPS"),null!==t&&t(e)}else r+=e,s.currentTime=r})}},s.src=this.video.src}currentImage(){return this.getImage()}getImage(t=this.currentTime){const e=this.currentTime;this.video.currentTime=t;const i=document.createElement("canvas");i.height=this.video.videoHeight,i.width=this.video.videoWidth;const s=i.getContext("2d");s&&s.drawImage(this.video,0,0,i.width,i.height);const n=new Image;return n.src=i.toDataURL(),this.video.currentTime=e,n}play(t=null,e={}){if(void 0===this.playInterval){this.trigger("play");let t=!0,i=this.currentTime,s=this.startFrame,n=this.endFrame;const o=1;for(const o in e){const a=e[o];switch(o){case"loop":t=a;break;case"startTime":case"startingTime":a>0&&a<this.duration&&(i=a);break;case"startFrame":case"startingFrame":a>=0&&a<this.frameCount&&(s=a);break;case"endFrame":case"endingFrame":a>0&&a<=this.frameCount&&(n=a)}}this.currentTime=i;let a=s;const r=this;this.playInterval=setInterval(function(){if(a<=n){const t=r.next();!1!==t&&(r.setFrame(t.number),a=t.number,a===n&&(a=n+100))}else r.setFrame(s),a=s;r.project.updateVisiblePoints(),void 0!==r.project.track&&null!==r.project.track&&void 0!==r.project.track.points[r.currentFrame]&&(r.project.track.unemphasizeAll(),r.project.track.points[r.currentFrame].emphasize())},200/o)}}pause(){clearInterval(this.playInterval),this.playInterval=void 0,this.trigger("pause")}seek(t){return this.savedFrame=t,this.seekSaved=!0,this}update(){this.seekSaved&&this.duration>0?(this.lastFrame=this.currentFrame,this.currentFrame=this.savedFrame,this.seekSaved=!1,this.lastFrame<this.currentFrame?this.direction="forward":this.direction="backward",this.currentTime=(this.currentFrame*this.frameTime).roundTo(3),this.trigger("seek")):this.currentTime=(this.currentFrame*this.frameTime).roundTo(3),this.video.currentTime!==this.currentTime&&(this.video.currentTime=this.currentTime)}updateTiming(t,e){const i=this.startFrame/this.frameCount||0,s=this.endFrame/this.frameCount||1;return this.duration=t.roundTo(3),this.fps=parseFloat(String(e)),this.frameTime=(1/this.fps).roundTo(3),this.frameCount=Math.floor(this.duration/this.frameTime),this.duration=(this.frameCount*this.frameTime).roundTo(3),this.startFrame=Math.floor(i*this.frameCount),this.endFrame=Math.floor(s*this.frameCount),this.trigger("timingUpdate"),this.duration}current(){return void 0!==this.frames[this.currentFrame]&&this.frames[this.currentFrame]}setFrame(t){const e=this.frames[t];if(void 0===e)return!1;this.lastFrame=this.currentFrame,this.currentFrame=e.number,this.currentTime=e.time.roundTo(3),this.video.currentTime=e.time,this.lastFrame<this.currentFrame?this.direction="forward":this.direction="backward",this.trigger("seek")}getClosestFrame(t=this.currentTime){return Math.floor((t/this.frameTime).roundTo(3))}getFrameStart(t){return(this.frameTime*t).roundTo(3)}next(){let t=this.currentFrame+this.frameSkip;this.currentFrame%this.frameSkip!==0&&(t-=this.currentFrame%this.frameSkip),t>this.endFrame&&(t=this.endFrame);const e=this.frames[t];return void 0!==e&&e}prev(){let t=this.currentFrame-this.frameSkip;this.currentFrame%this.frameSkip!==0&&(t+=this.frameSkip-this.currentFrame%this.frameSkip),t<this.startFrame&&(t=this.currentFrame-this.frameCount%this.frameSkip);const e=this.frames[t];return void 0!==e&&e}}(p.width,p.height,document.getElementById("video"),30),new Handsontable(b),g,f);v.timeline.video.addEventListener("loadstart",function(){const t=document.getElementById("video-clone");t.src=this.src,t.pause(),t.style.display="none"}),b.querySelectorAll("table").forEach(function(t){t.id="data-table-master"});const k=v.timeline.video,x=new createjs.Shape,w=x.graphics.beginFill("#000000").drawRect(0,0,200,30).command,S=new createjs.Text("Frame: 0, X: 0, Y: 0","13px Arial","#FFF");S.x=10,S.y=p.height-15,g.addChild(x),g.addChild(S),g.enableMouseOver(),createjs.Ticker.addEventListener("tick",g),g.addEventListener("tick",function(){v.created&&v.timeline.update()});const E=new c({name:"New Project",id:"new-project-modal",fields:{name:{label:"Name",type:"text",required:!0},framerate:{label:"Framerate",type:"number",required:!0,initVal:"30"},frameskip:{label:"# of frames to move",type:"number",required:!0,initVal:1},videospeed:{label:"Speed of video",type:"number",required:!0,initVal:1},axesColor:{label:"Axes Color",type:"color",defaultValue:"#ff69b4",required:!0},pointsBackward:{label:"Points Before Current Time",type:"number",defaultValue:"7",required:!0},pointsForward:{label:"Points Ahead of Current Time",type:"number",defaultValue:"0",required:!0}},buttons:{submit:{label:"Create"}}}),F=new c({name:"Save Project",id:"save-project-modal",fields:{filename:{label:"Filename",type:"text",required:!0}},buttons:{cancel:{label:"Cancel"},saveFile:{label:"Save as File",image:"icons/save_file_white.svg"},saveDrive:{label:"Save to Drive",image:"icons/drive_white.svg"}}}),C=new c({name:"Edit Project",id:"edit-project-modal",fields:{name:{label:"Name",type:"text",required:!0},frameskip:{label:"# of frames to move",type:"number",required:!0,initVal:1},axesColor:{label:"Axes Color",type:"color",defaultValue:"#ff69b4",required:!0},pointsBackward:{label:"Points Before Current Time",type:"number",defaultValue:"7",required:!0},pointsForward:{label:"Points Ahead of Current Time",type:"number",defaultValue:"0",required:!0}},buttons:{cancel:{label:"Cancel"},submit:{label:"Save"}}}),L=new c({name:"Export Data",id:"export-modal",fields:{filename:{label:"Filename",type:"text",required:!0}},buttons:{cancel:{label:"Cancel"},submit:{label:"Export"}}}),j=new c({name:"New Scale",id:"new-scale",fields:{color:{label:"Color",type:"color",required:!0}},buttons:{cancel:{label:"Cancel"},submit:{label:"Create"}}}),T=new c({name:"Edit Scale",id:"edit-scale",fields:{color:{label:"Color",type:"color",required:!0}},buttons:{cancel:{label:"Cancel"},submit:{label:"Save"}}}),z=new c({name:"New Track",id:"new-track",fields:{name:{label:"Name",type:"text",required:!0},color:{label:"Color",type:"color",required:!0}},buttons:{cancel:{label:"Cancel"},submit:{label:"Create"}}}),M=new c({name:"Edit Track",id:"edit-track",fields:{name:{label:"Name",type:"text",required:!0},color:{label:"Color",type:"color",required:!0},uid:{type:"hidden"}},buttons:{cancel:{label:"Cancel"},submit:{label:"Save"}}});function I(t,e){localStorage.setItem(t,e)}function B(t){return localStorage.getItem(t)}function _(t){localStorage.removeItem(t)}window.editTrack=M,window.addEventListener("beforeunload",function(t){if(v.saved)return null;{const e="You have made unsaved changes. If you leave without saving these changes will be lost.";return t.returnValue=e,e}});const A=document.getElementById("scrubber"),P=new createjs.Stage("scrubber");P.enableMouseOver(10);const D=new createjs.Shape;D.graphics.setStrokeStyle(1).beginStroke("#d8d8d8");const U=D.graphics.drawRoundRect(0,(A.height-10)/2,A.width-200,10,3,3,3,3).command;P.addChild(D);const R=new createjs.Shape;R.graphics.beginFill("#000"),R.regX=0,R.regY=0,R.rect=R.graphics.drawRoundRect(-2,-5,4,U.h,3,3,3,3).command,P.addChild(R);const V=new createjs.SpriteSheet({images:["icons/marker.png"],frames:{width:10,height:9},animations:{default:0}}),O=new createjs.Sprite(V,"default"),q=new createjs.Sprite(V,"default");O.regX=5,q.regX=5,P.addChild(O),P.addChild(q);const N={rectShape:D,thumbShape:new createjs.Shape,rect:U,thumb:R,startMarker:O,endMarker:q},X=new createjs.SpriteSheet({images:["icons/buttons.png"],frames:{width:20,height:20},animations:{frameBack:0,frameBackClicked:1,frameBackDisabled:2,frameForward:3,frameForwardClicked:4,frameForwardDisabled:5}}),J=new createjs.Sprite(X),H=new createjs.Sprite(X),W={forward:{sprite:J,button:new createjs.ButtonHelper(J,"frameForward","frameForward","frameForwardClicked",!1),enabled:!0},back:{sprite:H,button:new createjs.ButtonHelper(H,"frameBack","frameBack","frameBackClicked",!1),enabled:!0},update(){v.timeline.currentFrame===v.timeline.endFrame?(W.forward.sprite.gotoAndStop("frameForwardDisabled"),W.forward.button.enabled=!1,W.forward.enabled=!1):(W.forward.sprite.gotoAndStop("frameForward"),W.forward.button.enabled=!0,W.forward.enabled=!0),v.timeline.currentFrame===v.timeline.startFrame?(W.back.sprite.gotoAndStop("frameBackDisabled"),W.back.button.enabled=!1,W.back.enabled=!1):(W.back.sprite.gotoAndStop("frameBack"),W.back.button.enabled=!0,W.back.enabled=!0),P.update()}};function Y(t,e){N.thumb.x=t/e*N.rect.w+N.rect.x,N.startMarker.x=v.timeline.startFrame*(N.rect.w/v.timeline.frameCount)+N.rect.x,N.endMarker.x=v.timeline.endFrame*(N.rect.w/v.timeline.frameCount)+N.rect.x,P.update()}function Z(t=!1){if(window.innerWidth<1e3){if(!u.classList.contains("changed")){u.classList.remove("normal"),u.classList.add("hidden");const t=document.getElementById("sidebar-visibility");t&&(t.classList.add("show"),t.classList.remove("hide"))}}else if(!u.classList.contains("changed")){u.classList.add("normal"),u.classList.remove("hidden");const t=document.getElementById("sidebar-visibility");t&&(t.classList.add("hide"),t.classList.remove("show"))}const e=window.innerWidth-u.offsetWidth,i=window.innerHeight-50,s=document.getElementById("sidebar-visibility");s&&(s.style.right=u.offsetWidth+"px"),m.style.width=e+"px",m.style.height=i+"px";const n=Math.min(e/v.timeline.video.videoWidth,i/v.timeline.video.videoHeight);p.height=i,p.width=e,v.positioning.autoZoom&&(v.backgroundScale=n,f.scale=v.backgroundScale*v.positioning.zoom);const o=v.background;o.w=f.scale*v.timeline.video.videoWidth,o.h=f.scale*v.timeline.video.videoHeight,o.w<=p.width?v.positioning.x=(p.width-f.scale*v.timeline.video.videoWidth)/2:(v.positioning.x+o.w<p.width&&(v.positioning.x=p.width-o.w),v.positioning.x>0&&o.w>p.width&&(v.positioning.x=0)),o.h<=p.height?v.positioning.y=(p.height-f.scale*v.timeline.video.videoHeight)/2:(v.positioning.y+o.h<p.height&&(v.positioning.y=p.height-o.h),v.positioning.y>0&&o.h>p.height&&(v.positioning.y=0)),y.scale=f.scale,y.x=f.x,y.y=f.y,A.width=p.width,A.height=50,N.rect.w=A.width/g.scaleX-100,N.rect.h=10,N.rect.y=(A.height-10)/2,N.rect.x=15,N.thumb.y=N.rect.y,N.thumb.x=N.rect.x,N.thumb.rect.h=N.rect.h+10,W.forward.sprite.x=A.width-30,W.forward.sprite.y=(A.height-20)/2,W.back.sprite.x=A.width-60,W.back.sprite.y=(A.height-20)/2,S.x=10,S.regY=20,S.y=g.globalToLocal(0,p.height).y,x.regY=w.h,x.y=g.globalToLocal(0,p.height).y,N.startMarker.x=v.timeline.startFrame/v.timeline.frameCount*N.rect.w+N.rect.x,N.endMarker.x=v.timeline.endFrame/v.timeline.frameCount*N.rect.w+N.rect.x,N.startMarker.y=N.rect.y+N.rect.h+6,N.endMarker.y=N.rect.y+N.rect.h+6,v.handsOnTable.render(),Y(v.timeline.currentTime,v.timeline.duration),g.update(),v.updateScale(),P.update(),W.update()}P.addChild(W.forward.sprite),P.addChild(W.back.sprite),P.update(),k.addEventListener("playing",function(){k.pause(),k.currentTime=0,f.image=k,v.updateVisiblePoints(),Z(!0),k.style.display="none"}),g.on("stagemousemove",function(t){const e=t.target.stage.globalToLocal(t.stageX,t.stageY);"newScale"!==v.state.mode&&(S.text="Frame: "+v.timeline.currentFrame+", X: "+Math.round(e.x)+", Y: "+Math.round(e.y)),g.update()}),g.on("click",function(t){if(null!==v.track&&void 0!==v.track&&"add"===v.track.state.mode){const e=v.timeline.current();if(!1===e)return;const i=v.toScaled(t.stageX,t.stageY);v.track.addPoint(e,i.x,i.y);const s=v.timeline.next();if(!1===s)return;v.timeline.setFrame(s.number),void 0!==v.track.points[s.number]&&v.track.points[s.number].show().emphasize()}}),W.forward.sprite.on("click",function(){if(!0===W.forward.enabled){const t=v.timeline.next();!1!==t&&t.number<=v.timeline.endFrame&&!1!==v.timeline.setFrame(t.number)&&null!==v.track&&(v.track.unselectAll(),v.track.unemphasizeAll(),void 0!==v.track.points[t.number]&&v.track.points[t.number].show().emphasize())}}),W.back.sprite.on("click",function(){if(!0===W.back.enabled){const t=v.timeline.prev();!1!==t&&t.number>=v.timeline.startFrame&&!1!==v.timeline.setFrame(t.number)&&null!==v.track&&(v.track.unselectAll(),v.track.unemphasizeAll(),void 0!==v.track.points[t.number]&&v.track.points[t.number].show().emphasize())}}),N.thumb.on("pressmove",function(t){const e=t.target.stage.globalToLocal(t.stageX,t.stageY);if(e.x>=N.rect.x&&e.x<=N.rect.w+N.rect.x){const t=Math.round((e.x-N.rect.x)/N.rect.w*v.timeline.duration/v.timeline.frameTime);t<=v.timeline.endFrame&&t>=v.timeline.startFrame?(N.thumb.x=t*(N.rect.w/v.timeline.frameCount)+N.rect.x,v.timeline.seek(t)):t<v.timeline.startFrame?v.timeline.seek(v.timeline.startFrame):t>v.timeline.endFrame&&v.timeline.seek(v.timeline.endFrame)}else e.x<N.rect.w/v.timeline.frameCount*v.timeline.startFrame+N.rect.x?v.timeline.seek(v.timeline.startFrame):e.x>N.rect.w/v.timeline.frameCount*v.timeline.endFrame+N.rect.x&&v.timeline.seek(v.timeline.endFrame)});let K=!1;const G=[];N.startMarker.on("mousedown",function(){0===G.length&&G.push(v.timeline.startFrame)}),N.startMarker.on("pressmove",function(t){const e=t.target.stage.globalToLocal(t.stageX,t.stageY),i=v.timeline.getClosestFrame((e.x-N.rect.x)/N.rect.w*v.timeline.duration);i<=v.timeline.frameCount&&i<v.timeline.endFrame&&i>=0?(N.startMarker.x=i*(N.rect.w/v.timeline.frameCount)+N.rect.x,v.timeline.startFrame=i,v.timeline.currentFrame<=v.timeline.startFrame&&(K=!0),v.update()):i<0&&(N.startMarker.x=N.rect.x,v.timeline.startFrame=0,v.timeline.currentFrame<=v.timeline.startFrame&&(K=!0),v.update()),K&&v.timeline.seek(v.timeline.startFrame),W.update()}),N.startMarker.on("pressup",function(){const t=G[G.length-1];if(v.timeline.startFrame!==t){const e=t,i=v.timeline.startFrame,s=K,n=G.length;G.length>=1&&v.change({undo:function(){G.splice(n,1),N.startMarker.x=e*(N.rect.w/v.timeline.frameCount)+N.rect.x,v.timeline.startFrame=e,s&&v.timeline.seek(v.timeline.startFrame),v.update()},redo:function(){G.push(i),N.startMarker.x=i*(N.rect.w/v.timeline.frameCount)+N.rect.x,v.timeline.startFrame=i,s&&v.timeline.seek(v.timeline.startFrame),v.update()}})}G.push(v.timeline.startFrame),K=!1});let Q=!1;const $=[];N.endMarker.on("mousedown",function(){0===$.length&&$.push(v.timeline.endFrame)}),N.endMarker.on("pressmove",function(t){const e=t.target.stage.globalToLocal(t.stageX,t.stageY),i=v.timeline.getClosestFrame((e.x-N.rect.x)/N.rect.w*v.timeline.duration);i<=v.timeline.frameCount&&i>v.timeline.startFrame?(N.endMarker.x=i*(N.rect.w/v.timeline.frameCount)+N.rect.x,v.timeline.endFrame=i,v.timeline.currentFrame>v.timeline.endFrame&&(Q=!0),v.update()):i>v.timeline.frameCount&&(N.endMarker.x=v.timeline.frameCount*(N.rect.w/v.timeline.frameCount)+N.rect.x,v.timeline.endFrame=v.timeline.frameCount,v.timeline.currentFrame>=v.timeline.endFrame&&(Q=!0),v.update()),Q&&v.timeline.seek(v.timeline.endFrame),W.update()}),N.endMarker.on("pressup",function(){const t=$[$.length-1];if(v.timeline.endFrame!==t){const e=t,i=v.timeline.endFrame,s=Q,n=$.length;$.length>=1&&v.change({undo:function(){$.splice(n,1),N.endMarker.x=e*(N.rect.w/v.timeline.frameCount)+N.rect.x,v.timeline.endFrame=e,s&&v.timeline.seek(v.timeline.endFrame),v.update()},redo:function(){$.push(i),N.endMarker.x=i*(N.rect.w/v.timeline.frameCount)+N.rect.x,v.timeline.endFrame=i,s&&v.timeline.seek(v.timeline.endFrame),v.update()}})}$.push(v.timeline.endFrame),Q=!1});let tt={x:0,y:0},et={x:v.positioning.x,y:v.positioning.y},it={w:v.background.w,h:v.background.h};v.addBackground.on("mousedown",function(t){tt={x:t.stageX,y:t.stageY},et={x:v.positioning.x,y:v.positioning.y},it={w:v.background.w,h:v.background.h}}),v.addBackground.on("pressmove",function(t){const e=t.target.stage.globalToLocal(t.stageX,t.stageY);if("positioning"===v.state.mode){const t={x:et.x+e.x-tt.x,y:et.y+e.y-tt.y};t.x+it.w<p.width&&(t.x=p.width-it.w),t.x>0&&it.w>p.width&&(t.x=0),t.y+it.h<p.height&&(t.y=p.height-it.h),t.y>0&&it.h>p.height&&(t.y=0),it.w>p.width&&(v.positioning.x=t.x,v.positioning.stuck=!1),it.h>p.height&&(v.positioning.y=t.y,v.positioning.stuck=!1)}}),p.addEventListener("wheel",function(t){t.preventDefault(),"positioning"===v.state.mode&&((v.positioning.zoom>.01||-1===Math.sign(t.deltaY))&&(v.positioning.zoom-=t.deltaY/25),v.positioning.zoom<=.01&&(v.positioning.zoom=.01))}),v.positioning.on("zoomin, zoomout",function(t){const e=this.background,i={x:v.positioning.x,y:v.positioning.y};i.x-=this.timeline.video.videoWidth*(t.delta||0)/2,i.y-=this.timeline.video.videoHeight*(t.delta||0)/2,e.w>this.stage.canvas.width?i.x+e.w<this.stage.canvas.width?this.positioning.x=p.width-e.w:i.x>0?this.positioning.x=0:this.positioning.x=i.x:this.positioning.x=(this.stage.canvas.width-e.w)/2,e.h>this.stage.canvas.height?i.y+e.h<this.stage.canvas.height?this.positioning.y=p.height-e.h:i.y>0?this.positioning.y=0:this.positioning.y=i.y:this.positioning.y=(this.stage.canvas.height-e.h)/2}).on("zoom, translation",function(){const t=this.background;y.scale=t.scale,y.x=t.x,y.y=t.y}).on("zoom",function(){const t=document.getElementById("screen-fit-button");t&&t.classList.remove("disabled")});const st=g.children.find(t=>t instanceof createjs.Text)||new createjs.Text("","","");v.on("deleteTrack",function(){if(0===Object.keys(v.trackList).length){const t=document.getElementById("tracks");t&&t.classList.add("hidden")}}),v.on("undeleteTrack",function(){if(Object.keys(v.trackList).length>0){const t=document.getElementById("tracks");t&&t.classList.remove("hidden")}}),v.on("newScale",function(){const t=document.getElementById("scale-button");t&&(t.title="Edit Scale")}),v.on("newTrack",function(){const t=document.getElementById("tracks");t&&t.classList.remove("hidden");const e=document.getElementById("export-button");e&&e.classList.remove("disabled")}),v.on("newpoint",function(){const t=document.getElementById("graphs");t&&t.classList.remove("hidden")}),v.on("created",function(){N.startMarker.x=this.timeline.startFrame*(N.rect.w/this.timeline.frameCount)+N.rect.x,N.endMarker.x=this.timeline.endFrame*(N.rect.w/this.timeline.frameCount)+N.rect.x,Y(v.timeline.currentTime,v.timeline.duration),this.updateVisiblePoints(),W.update()});let nt=null;v.timeline.on("seek, timingUpdate",function(){this.project.updateVisiblePoints(),W.update(),st.text="Frame: "+v.timeline.currentFrame+", X: "+g.mouseX+", Y: "+g.mouseY,null!==this.project.track&&void 0!==this.project.track&&(this.project.track.unemphasizeAll(),void 0!==this.project.track.points[this.project.timeline.currentFrame]&&this.project.track.points[this.project.timeline.currentFrame].emphasize()),Y(v.timeline.currentTime,v.timeline.duration);const t=document.getElementById("video-clone");null!==nt&&clearTimeout(nt),nt=setTimeout(function(){t.currentTime=v.timeline.currentTime},100)}),v.timeline.on("play",function(){const t=document.getElementById("video-clone");t&&(t.style.opacity="0")}),v.timeline.on("pause",function(){const t=document.getElementById("video-clone");t&&(t.style.opacity="1")});class ot{constructor(t){this.apiKey=t.apiKey,this.clientId=t.clientId,this.buttonEl=t.buttonEl,this.logoutEl=t.logoutEl,this._getFile=t.getFile,this.buttonEl.addEventListener("click",this.open.bind(this)),this.logoutEl.addEventListener("click",function(){this.classList.contains("disabled")||(gapi.auth.signOut(),this.classList.add("disabled"))}.bind(this.logoutEl)),this.buttonEl.disabled=!0,gapi.client.setApiKey(this.apiKey),gapi.client.load("drive","v2",this._driveApiLoaded.bind(this))}open(){gapi.auth.getToken()&&!this.logoutEl.classList.contains("disabled")?(this._upload(),this.logoutEl.classList.remove("disabled")):this._doAuth(!1,()=>{this._upload(),this.logoutEl.classList.remove("disabled")})}_upload(){this._getFile(function(t,e,i){const s={name:e};gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"resumable"},headers:{"X-Upload-Content-Type":"application/x-zip","X-Upload-Content-Length":String(t.byteLength),"Content-Type":"application/json; charset=UTF-8","Content-Length":String(JSON.stringify(s).utf8Length())},body:s}).then(function(e){const s=e.headers.location,n=new XMLHttpRequest;n.open("PUT",s,!0);const o=gapi.auth.getToken();o&&n.setRequestHeader("Authorization","Bearer "+o.access_token),n.setRequestHeader("Content-Type","application/x-zip"),n.setRequestHeader("X-Upload-Content-Type","application/x-zip"),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE?i(!0):i(!1)},n.send(t)})})}_driveApiLoaded(){this.buttonEl.disabled=!1,this._doAuth(!0)}_doAuth(t,e){this.logoutEl.classList.contains("disabled")?gapi.auth.authorize({client_id:this.clientId+".apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive",immediate:t,authuser:-1},e):gapi.auth.authorize({client_id:this.clientId+".apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive",immediate:t},e)}}E.on("submit",function(t){if(!t)return;v.name=t.name,v.videoSpeed=parseFloat(t.videospeed),v.timeline.frameSkip=parseInt(t.frameskip),v.timeline.updateTiming(v.timeline.video.duration,t.framerate),v.timeline.createFrames();const e=v.toScaled(p.width/2,p.height/2);v.newAxes(e.x,e.y,t.axesColor,!0),this.hide().clear(),v.viewPoints={forward:parseInt(t.pointsForward),backward:parseInt(t.pointsBackward)},v.updateVisiblePoints(),v.created=!0,v.trigger("created"),gtag("event","New Project",{event_category:"Start",event_label:v.name})}),F.on("saveFile",function(i){if(!i)return;e();const s=URL.createObjectURL(v.videoFile);JSZipUtils.getBinaryContent(s,function(e,s){e&&console.log(e);let n=i.filename||"";0===n.length?n=v.name.toLowerCase().replace(" ","_")+"-"+(new Date).getTime()+"."+h:n.split(".").pop()!==h&&(n+="."+h);const o=JSON.stringify(v.save()),a=new JSZip;a.file("video.mp4",s,{binary:!0}).file("meta.json",o),a.generateAsync({type:"blob",mimeType:"application/octet-stream"}).then(function(e){saveAs(e,n),v.saved=!0,t()},function(t){console.log(t)})}),this.hide().clear()}).on("create",function(){const i=document.getElementById(this.id+"_button-saveDrive");i&&(i.disabled=!0);const s=this,n=setInterval(function(){try{if("undefined"!=typeof gapi&&void 0!==gapi.client){const i=document.getElementById("logout-button"),o=document.getElementById(s.id+"_button-saveDrive");o&&i&&new ot({apiKey:"AIzaSyDIijziwMBTuCoKGMXhaVzBzUZibDVwiBM",clientId:"44440188363-5vnafandpsrppr9189u7sc8q755oar9d",buttonEl:o,logoutEl:i,getFile:function(i){e();const n=URL.createObjectURL(v.videoFile);JSZipUtils.getBinaryContent(n,function(e,n){e&&console.log(e);const o=s.export();let a=o&&o.filename||"";0===a.length?a=v.name.toLowerCase().replace(" ","_")+"-"+(new Date).getTime()+"."+h:a.split(".").pop()!==h&&(a+="."+h);const r=JSON.stringify(v.save()),l=new JSZip;l.file("video.mp4",n,{binary:!0}).file("meta.json",r),l.generateAsync({type:"blob",mimeType:"application/octet-stream"}).then(function(e){const n=new FileReader;n.onload=function(){i(n.result,a,function(e){t(),s.hide()})},n.readAsArrayBuffer(e)},function(t){console.log(t)})})}}),clearInterval(n)}}catch(t){console.log("Google could not be loaded."),clearInterval(n)}},400)}).on("cancel",function(){this.hide().clear()}),C.on("submit",function(t){var e;t&&(v.name=t.name,v.timeline.frameSkip=parseInt(t.frameskip),null===(e=v.axes)||void 0===e||e.updateColor(t.axesColor),this.hide().clear(),v.viewPoints={forward:parseInt(t.pointsForward),backward:parseInt(t.pointsBackward)},v.updateVisiblePoints())}).on("cancel",function(){this.hide().clear()}),L.on("submit",function(t){if(!t)return;const e=XLSX.utils.book_new();for(const t in v.trackList){const i=v.trackList[t],s=XLSX.utils.aoa_to_sheet(i.export().table.scaled);XLSX.utils.book_append_sheet(e,s,i.name)}let i=t.filename;i.split(".").length<=1&&(i+=".xlsx"),d.includes(i.split(".")[i.split(".").length-1])||(i+=".xlsx"),XLSX.writeFile(e,i),this.hide().clear()}).on("cancel",function(){this.hide().clear()}),T.on("cancel",function(){this.hide().clear()}).on("submit",function(t){var e;t&&(null===(e=v.scale)||void 0===e||e.updateInfo({color:t.color}),this.hide())});let at=3;var rt,lt,ct,dt,ht,ut,mt,pt,gt,ft,yt,bt;j.on("submit",function(t){if(!t)return;v.state.mode="newScale",at=1;const e={point1:{x:0,y:0},point2:{x:0,y:0}},i=g.children.find(t=>t instanceof createjs.Text);i&&(i.text="Click for 1st end of scale"),g.on("click",function(s){const n=v.toScaled(s.stageX,s.stageY);if(1===at)e.point1={x:n.x,y:n.y},i&&(i.text="Click for 2nd end of scale"),at++;else if(2===at){e.point2={x:n.x,y:n.y};const i=v.newScale(null,e.point1.x,e.point1.y,e.point2.x,e.point2.y,t.color);window.setTimeout(function(){i.textElement.dispatchEvent(new Event("startEditing")),i.textElement.value="",i.textElement.focus()},200),g.cursor="default",v.state.default(),at++}}),this.hide().clear()}).on("cancel",function(){this.hide().clear()}),M.on("cancel",function(){this.hide().clear()}).on("submit",function(t){t&&(void 0!==v.trackList[t.uid]&&v.trackList[t.uid].update({name:t.name,color:t.color}),this.hide())}),z.on("cancel",function(){this.hide().clear()}).on("submit",function(t){t&&(this.hide().clear(),v.newTrack(t.name,t.color,!0))}),keyboardJS.pause(),keyboardJS.on("shift",function(t){if(t.preventRepeat(),null!==v.track&&void 0!==v.track){v.state.mode="add";for(const t in v.trackList)v.trackList[t].state.mode="add"}},function(){if(null!==v.track&&void 0!==v.track){v.state.reset();for(const t in v.trackList)v.trackList[t].state.resetMode()}}),keyboardJS.on("s",function(t){t.preventRepeat(),v.state.mode="seek"},function(){v.state.reset()}),keyboardJS.on(["delete","backspace"],function(){void 0!==v.track&&null!==v.track&&null!==v.track.selectedPoint&&void 0!==v.track.selectedPoint&&v.track.selectedPoint.shape.dispatchEvent(new Event("dblclick"))}),keyboardJS.on(["up","down","right","left"],function(t){const e=v.background,i={x:v.positioning.x,y:v.positioning.y};switch(t.key){case"ArrowLeft":i.x+=20;break;case"ArrowRight":i.x-=20;break;case"ArrowUp":i.y+=20;break;case"ArrowDown":i.y-=20}i.x+e.w<p.width&&(i.x=p.width-e.w),i.x>0&&e.w>p.width&&(i.x=0),i.y+e.h<p.height&&(i.y=p.height-e.h),i.y>0&&e.h>p.height&&(i.y=0),e.w>p.width&&(v.positioning.x=i.x,v.positioning.stuck=!1),e.h>p.height&&(v.positioning.y=i.y,v.positioning.stuck=!1)}),keyboardJS.on(["ctrl + =","ctrl + +","cmd + =","cmd + +"],function(t){t.preventDefault(),v.positioning.zoom+=.01}),keyboardJS.on(["ctrl + -","cmd + -"],function(t){t.preventDefault(),v.positioning.zoom>.02?v.positioning.zoom-=.01:v.positioning.zoom=.01}),keyboardJS.on(["=","+"],function(){v.positioning.zoom+=.05}),keyboardJS.on("-",function(){v.positioning.zoom>.1?v.positioning.zoom-=.05:v.positioning.zoom=.05}),keyboardJS.on(["ctrl + 0","cmd + 0"],function(t){t.preventDefault(),v.positioning.zoom=1,v.positioning.autoZoom=!0,v.positioning.stuck=!0,Z();const e=document.getElementById("screen-fit-button");e&&e.classList.add("disabled")}),keyboardJS.on("ctrl",function(t){t.preventRepeat(),v.state.mode="positioning"},function(){v.state.reset()}),keyboardJS.on(["ctrl+z","cmd+z"],function(){v.undo()}),keyboardJS.on(["ctrl+y","cmd+y"],function(){v.redo()}),keyboardJS.on(["ctrl+s","cmd+s"],function(t){t.preventRepeat(),t.preventDefault(),F.show()}),null===(rt=document.getElementById("new-project"))||void 0===rt||rt.addEventListener("click",function(){window.location.reload()}),null===(lt=document.getElementById("sidebar-visibility"))||void 0===lt||lt.addEventListener("click",function(){const t=document.getElementById("sidebar"),e=document.getElementById("sidebar-visibility");t&&e&&(this.classList.contains("show")?(t.classList.add("normal"),t.classList.remove("hidden"),e.classList.add("hide"),e.classList.remove("show")):(t.classList.remove("normal"),t.classList.add("hidden"),e.classList.add("show"),e.classList.remove("hide")),t.classList.add("changed"),e.style.right=t.offsetWidth+"px",Z())}),null===(ct=document.querySelector("#new-track-button:not(.disabled)"))||void 0===ct||ct.addEventListener("click",function(){z.push({color:z.defaultColors[Math.floor(Math.random()*z.defaultColors.length)]}),z.show()}),null===(dt=document.getElementById("play-pause-button"))||void 0===dt||dt.addEventListener("click",function(){this.classList.contains("play")?(v.timeline.play(),this.classList.remove("play"),this.classList.add("pause")):(v.timeline.pause(),this.classList.remove("pause"),this.classList.add("play"))}),null===(ht=document.querySelector("#undo-button:not(.disabled)"))||void 0===ht||ht.addEventListener("click",function(){v.undo()}),null===(ut=document.querySelector("#screen-fit-button"))||void 0===ut||ut.addEventListener("click",function(){this.classList.contains("disabled")||(v.positioning.zoom=1,v.positioning.autoZoom=!0,v.positioning.stuck=!0,Z(),this.classList.add("disabled"))}),null===(mt=document.querySelector("#redo-button:not(.disabled)"))||void 0===mt||mt.addEventListener("click",function(){v.redo()}),null===(pt=document.getElementById("export-button"))||void 0===pt||pt.addEventListener("click",function(){this.classList.contains("disabled")||L.show()}),null===(gt=document.querySelector("#save-button:not(.disabled)"))||void 0===gt||gt.addEventListener("click",function(){F.show()}),document.querySelectorAll(".help-button:not(.disabled)").forEach(function(t){t.addEventListener("click",function(){window.open("using_jstrack.pdf","_blank")})}),null===(ft=document.querySelector("#scale-button:not(.disabled)"))||void 0===ft||ft.addEventListener("click",function(){void 0!==v.scale&&null!==v.scale?T.push({color:v.scale.color}).show():j.show()}),null===(yt=document.querySelector("#edit-project-button:not(.disabled)"))||void 0===yt||yt.addEventListener("click",function(){v.axes&&C.push({name:v.name,framerate:String(v.timeline.fps),frameskip:String(v.timeline.frameSkip),axesColor:v.axes.color,pointsForward:String(v.viewPoints.forward),pointsBackward:String(v.viewPoints.backward)}).show()}),v.on("undo, created, change",function(){const t=document.getElementById("undo-button");t&&(this.undoManager.hasUndo()?t.classList.remove("disabled"):t.classList.add("disabled"))}),v.on("redo, created, change",function(){const t=document.getElementById("redo-button");t&&(this.undoManager.hasRedo()?t.classList.remove("disabled"):t.classList.add("disabled"))});const vt=null===(bt=document.getElementById("track-list"))||void 0===bt?void 0:bt.querySelector("ul");function kt(t,e=null){v.videoFile=t,v.timeline.video.src=URL.createObjectURL(t),null!==e&&v.timeline.video.addEventListener("playing",e)}function xt(){const t=document.getElementById("modal-container");t&&(t.classList.remove("active"),t.classList.remove("launch"));const e=document.getElementById("launch");e&&e.classList.remove("active");const i=document.getElementById("help-fab");i&&i.remove();const s=document.getElementById("github-fab");s&&s.remove();const n=document.getElementById("paypal-fab");n&&n.remove(),keyboardJS.resume()}vt&&vt.querySelectorAll("li").forEach(function(t){t.addEventListener("click",function(){const t=this.getAttribute("data-uid");t&&v.switchTrack(t)}),t.addEventListener("dblclick",function(){const t=this.getAttribute("data-uid");t&&void 0!==v.trackList[t]&&M.push({name:v.trackList[t].name,color:v.trackList[t].color,uid:t}).show()})});let wt=!1;function St(i){const s=[...i];s.length>0&&function(i,s=null){const n=i.type||"",o=i.name||"";switch(n){case"video/mp4":if(!1!==wt){let e=!1;e=o===wt.name||!!confirm("This file doesn't match what the original video was named. Continue?"),e&&kt(i,function(){null!==s&&s(),!1!==wt&&v.load(wt.data),t(),xt(),v.saved=!0,v.trigger("created"),gtag("event","Import Video Existing Project",{event_category:"Start",event_label:v.name})})}else v.videoName=o,kt(i,function(){null!==s&&s(),v.timeline.detectFrameRate(function(e){xt(),E.push({framerate:String(e)}),E.show(),t()})});break;case"":case"application/x-zip":o.split(".").pop()===h?(function(e,i=null){const s=URL.createObjectURL(e);JSZipUtils.getBinaryContent(s,function(e,s){if(e)throw e;JSZip.loadAsync(s).then(function(e){void 0!==e.files["video.mp4"]&&e.file("video.mp4").async("blob").then(function(s){kt(s,function(){void 0!==e.files["meta.json"]&&e.file("meta.json").async("text").then(function(e){v.load(JSON.parse(e)),t(),v.saved=!0,v.trigger("created"),null!==i&&i()})})})})})}(i,s),xt(),gtag("event","Load Project File",{event_category:"Start",event_label:o})):(alert("This filetype is not supported. It must be .mp4 or ."+h),t());break;default:if("video"===n.split("/")[0])if(confirm("The only supported video type is mp4. Would you like to try the experimental video converter? (sometimes doesn't work, especially for longer videos)")){gtag("event","Agreed to Try Convertor",{event_category:"Start",event_label:n}),e();const a=new FileReader;a.onload=function(e){var i;const a=null===(i=e.target)||void 0===i?void 0:i.result,r=new Worker("src/ffmpeg-worker-mp4.js");r.onmessage=function(e){const i=e.data;switch(i.type){case"ready":r.postMessage({MEMFS:[{name:o,data:a}],type:"run",arguments:["-i",o,"-vcodec","copy","-acodec","copy","out.mp4"]});break;case"done":{const e=i.data.MEMFS[0],a=o.indexOf("."),r=o.substring(0,-1!==a?a:o.length),l=new File([e.data],r+".mp4",{type:"video/mp4"});v.videoName=l.name,kt(l,function(){null!==s&&s(),v.timeline.detectFrameRate(function(e){xt(),E.push({framerate:String(e)}),E.show(),t()})}),gtag("event","Convertor Done",{event_category:"Start",event_label:n});break}}}},a.readAsArrayBuffer(i)}else confirm("Would you like to open a free online video converter in another tab?")?(t(),window.open("https://video.online-convert.com/convert-to-mp4","_blank")):t();else t(),alert("This filetype is not supported. It must be .mp4 or ."+h)}}(s[0])}function Et(t){const e=document.getElementById("backup-status");if(e)switch(t){case 1:e.style.opacity="1",e.style.backgroundColor="yellow",v.backUpDate&&(e.title="Partially backed up on "+v.backUpDate.toLocaleDateString()+" at "+v.backUpDate.toLocaleTimeString());break;case 2:e.style.opacity="1",e.style.backgroundColor="#07ff07",v.backUpDate&&(e.title="Backed up on "+v.backUpDate.toLocaleDateString()+" at "+v.backUpDate.toLocaleTimeString());break;case"loading":e.style.opacity="0.5",e.style.backgroundColor="grey",e.title="Backing up...";break;default:e.style.opacity="1",e.style.backgroundColor="red",e.title="Unable to backup changes"}}v.on("change",function(){this.saved||!this.created||this.backedUp?this.saved&&_("backup"):(Et("loading"),function(){let t=!1;const e=URL.createObjectURL(v.videoFile);JSZipUtils.getBinaryContent(e,function(e,i){e&&(console.log(e),t=!1,Et(t));const s=JSON.stringify(v.save()),n=B("backup");let o=n?JSON.parse(n):null;null===o&&(o={uid:"",video:null,date:null});const a={uid:String(v.uid),date:(new Date).toString(),videoName:v.videoName,video:void 0,data:void 0},r=o.uid===String(v.uid);_("backup");const l=new JSZip;l.file("meta.json",s),l.generateAsync({type:"blob"}).then(function(e){const s=new FileReader;s.readAsDataURL(e),s.onload=function(){try{if(a.data=s.result,I("backup",JSON.stringify(a)),null!==o.video&&""!==o.video&&void 0!==o.video&&r)if(r)if(null!==o.video&&""!==o.video&&void 0!==o.video)try{I("video",o.video),_("video"),a.video=o.video,I("backup",JSON.stringify(a)),v.backup(),t=2,Et(t)}catch(e){a.video=void 0,I("backup",JSON.stringify(a)),v.backup(),t=1,Et(t)}else t=1,Et(t);else t=1,Et(t);else{const e=new JSZip;e.file("video.mp4",i,{binary:!0}),e.generateAsync({type:"blob"}).then(function(e){const i=new FileReader;i.readAsDataURL(e),i.onload=function(){try{I("video",i.result),_("video"),a.video=i.result,I("backup",JSON.stringify(a)),v.backup(),t=2,Et(t)}catch(e){a.video=void 0,I("backup",JSON.stringify(a)),v.backup(),t=1,Et(t)}}},function(e){console.log(e),t=!1,Et(t)})}}catch(e){n&&I("backup",n),v.backup(),t=!1,Et(t)}}},function(e){console.log(e),t=!1,Et(t)})})}())});const Ft=B("backup");if(null!=Ft&&""!==Ft){const s=document.getElementById("launch");if(s&&s.classList.contains("active")){const s=JSON.parse(Ft),n=s.date||(new Date).toString(),o=new Date(n).toLocaleString();if(confirm("You have a project backup from "+o+". Would you like to recover this?"))if(void 0!==s.video&&null!==s.video&&""!==s.video){e();const n=i(s.video),o=URL.createObjectURL(n);JSZipUtils.getBinaryContent(o,function(e,n){if(e)throw e;JSZip.loadAsync(n).then(function(e){e.file("video.mp4").async("blob").then(function(e){kt(e,function(){if(void 0!==s.data&&null!==s.data&&""!==s.data){const e=i(s.data),n=URL.createObjectURL(e);JSZipUtils.getBinaryContent(n,function(e,i){if(e)throw e;JSZip.loadAsync(i).then(function(e){e.file("meta.json").async("text").then(function(e){v.load(JSON.parse(e)),t(),xt(),v.saved=!0,v.trigger("created")})})})}})})})})}else if(void 0!==s.data&&null!==s.data&&""!==s.data){const t=i(s.data),e=URL.createObjectURL(t);JSZipUtils.getBinaryContent(e,function(t,e){if(t)throw t;JSZip.loadAsync(e).then(function(t){t.file("meta.json").async("text").then(function(t){var e;let i="",n="";if(void 0!==s.videoName&&null!==s.videoName&&""!==s.videoName&&(i="("+s.videoName+") ",n=s.videoName),confirm("There is no video saved in this backup, you will need to be able to access the original video "+i+"to load it yourself. Would you like to continue?")){const i=null===(e=document.getElementById("file-drop-area"))||void 0===e?void 0:e.querySelector(".text");i&&(i.textContent="Drag the video here to recover your project, or"),o={name:n,data:JSON.parse(t)},wt=o}else confirm("Would you like to remove this backup from storage?")&&_("backup");var o})})})}else confirm("Error opening project. Would you like to remove it from storage?")&&_("backup");else confirm("Would you like to delete this from storage?")&&_("backup")}}interact("#sidebar").resizable({edges:{left:!0},restrictEdges:{outer:"parent",endOnly:!0},restrictSize:{min:{width:400},max:{width:window.innerWidth-300}},inertia:!0}).on("resizemove",function(t){t.target.style.width=t.rect.width+"px";const e=document.getElementById("sidebar-visibility");e&&(e.style.right=t.rect.width+"px")}).on("resizeend",function(){Z()});const Ct=document.getElementById("sidebar"),Lt=dragula(Ct?[Ct]:[],{direction:"vertical",moves:function(t,e,i){return!!i.classList.contains("handle-bar")&&(i.style.cursor="grabbing",!0)}});let jt,Tt=0,zt=null;Lt.on("drag",function(t){const e=t.querySelector(".handle-bar");e&&(e.style.cursor="grabbing"),zt=setInterval(function(){const t=document.querySelector(".gu-mirror");if(!t)return;const e=t.getBoundingClientRect();Tt=Lt.dragging?e.top<100?-1:e.top>window.innerHeight-100?1:0:0;const i=document.getElementById("sidebar");i&&(i.scrollTop+=20*Tt)},100)}).on("dragend",function(t){const e=t.querySelector(".handle-bar");e&&(e.style.cursor="grab"),null!==zt&&(clearInterval(zt),zt=null)}),window.addEventListener("resize",function(){clearTimeout(jt),jt=setTimeout(Z,250);const t=document.getElementById("sidebar-visibility");t&&(t.style.right=u.offsetWidth+"px")});const Mt=document.getElementById("file-drop-area");Mt&&(["dragenter","dragover","dragleave","drop"].forEach(function(t){Mt.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation()},!1),document.body.addEventListener(t,function(t){t.preventDefault(),t.stopPropagation()},!1)}),["dragenter","dragover"].forEach(function(t){Mt.addEventListener(t,function(){Mt.classList.add("highlight")},!1)}),["dragleave","drop"].forEach(function(t){Mt.addEventListener(t,function(){Mt.classList.remove("highlight")},!1)}),Mt.addEventListener("drop",function(t){e();const i=t.dataTransfer;i&&St(i.files)},!1));const It=document.getElementById("file-input");It&&It.addEventListener("change",function(){this.files&&(St(this.files),e())})})();
//# sourceMappingURL=bundle.js.map